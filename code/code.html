


<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Code &#8212; pNNE  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=59fa5063" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=927b94d3fcb96560df09"></script>

    <script src="../_static/documentation_options.js?v=8a448e45"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'code/code';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Welcome to pNNE" href="../index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
   

<a class="navbar-brand logo" href="https://pnnehome.github.io">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
    <p class="title logo__title">pNNE</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                         Code
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                         Code
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Code</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="code">
<span id="id1"></span><h1>Code<a class="headerlink" href="#code" title="Link to this heading">#</a></h1>
<p>You can download the Matlab files <a class="reference external" href="https://drive.google.com/u/0/uc?id=1D007UsTPUCKRoi6ofuGjI3v6txeIpTtr&amp;export=download">here</a> (beta version; sep_17_2023).</p>
<p>Below are documentation for each file. We suggest you first read the example in introduction, which is an easier way to get an idea of how the code works.</p>
<p>Current settings on the range of data accepted by pNNE:</p>
<p>Current settings are relatively restrictive as pNNE is still in beta stage. We can change these settings in the next version of pNNE if there are requests to do so. Please contact us if you want to see a setting broadened.</p>
<ul class="simple">
<li><p><span class="brown-text">Sample size</span>: n ≥ 1000 number of consumers (or search sessions).</p></li>
<li><p><span class="brown-text">Number of options</span> per consumer: 15 ≤ J ≤ 35.</p></li>
<li><p>Number of <span class="brown-text">product attributes</span>: 2 ≤ p ≤ 8. Number of consumer attributes:  0 ≤ c ≤ 5. Number of advertising attributes:  0 ≤ a ≤ 2.</p></li>
<li><p><span class="brown-text">Buy rate</span> (fraction of consumers who didn’t buy outside good) is between 0.5% and 50%.</p></li>
<li><p><span class="brown-text">Search rate</span> (fraction of consumers who went beyond the free search) is between 1% and 70%.</p></li>
<li><p><span class="brown-text">Average number of searches</span> per consumer is between 1 and 4.</p></li>
</ul>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">trained_nne.mat</span></code></p>
<p>This file stores the trained neural net as well as some settings.</p>
<ul class="simple">
<li><p>net: a structure that stores the trained neural net.</p></li>
<li><p>prior: a structure that stores some settings used in training, such as the largest number of product attributes allowed, the smallest sample size allowed, the range of search model parameters considered, etc.</p></li>
</ul>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">nne_estimate.m</span></code></p>
<p>The main function to apply pNNE to your data.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">result = nne_estimate(net, prior, Y, Xp, Xa, Xc, consumer_idx, se=false, checks=true)</span>
</pre></div>
</div>
<p>Inputs:</p>
<ul class="simple">
<li><p>net and prior: as described before, from trained_nne.mat.</p></li>
<li><p>Y: nJ by 2 matrix.  Y(J*(i-1)+j, 1) indicates whether consumer i searched option j. Y(J*(i-1)+j, 2) indicates whether consumer i bought option j.</p></li>
<li><p>Xp: nJ by p matrix. Xp(J*(i-1)+j, :) stores the product attributes of option j for consumer i.</p></li>
<li><p>Xa: nJ by a matrix. Xa(J*(i-1)+j, :) stores the marketing attributes of option j for consumer i.</p></li>
<li><p>Xc: n by c matrix. Xc(i, :) stores the consumer attributes of consumer i.</p></li>
<li><p>consumer_idx: nJ by 1 vector.  consumer_idx(J*(i-1)+1:J*i) = i.</p></li>
<li><p>se=false: optional input. Set to true to calculate bootstrap standard errors.</p></li>
<li><p>checks=true: optional input. Set to false to omit all sanity checks.</p></li>
</ul>
<p>Outputs:</p>
<ul class="simple">
<li><p>result: a table listing parameters and their estimates. If se=false, it has an additional column of standard errors.</p></li>
</ul>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">moments.m</span></code></p>
<p>This function is used by nne_estimate.m. The function computes summary moments from data. These summary moments
are then fed into the neural net as inputs.</p>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">regress_coef.m</span></code></p>
<p>This function is used by moments.m. The function does ridge linear, logit, and multinomial logit regressions.
These regressions are applied to the data to produce some of the summary moments.</p>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">mseLayer.m</span></code></p>
<p>This function is a custom neural net layer used by our trained neural net. It is basically the same as
Matlab’s built-in regressionLayer.m, except that it has some minor customization to better suit pNNE training.</p>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">search_stat.m</span></code></p>
<p>This function calculates some summary statistics of the data. It is used by nne_estimate.m to perform
a part of the data saneity checks.</p>
<p><code class="docutils literal notranslate"><span class="pre">curve.mat</span></code></p>
<p>This file stores the relation describing how log search cost affects reservation utility.</p>
<ul class="simple">
<li><p>curve: a table that stores a grid of log search cost and corresponding reservation utility.</p></li>
</ul>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">search_model.m</span></code></p>
<p>The function that codes the search model. This function is used in training but not in estimation.
We provide it for reference purpose. It is also useful if you want to conduct Monte Carlo experiments.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Y = search_model(par, curve, Xp, Xa, Xc, consumer_idx)</span>
</pre></div>
</div>
<p>Inputs:</p>
<ul class="simple">
<li><p>par: vector of parameter value. First a+1 entries are α. Next c+1 entries are η. Last p entries are β.</p></li>
<li><p>curve: as described before, from curve.mat.</p></li>
<li><p>Xp, Xa, Xc, and consumer_idx: as described before.</p></li>
</ul>
<p>Outputs</p>
<ul class="simple">
<li><p>Y: as described above. Simulated search and purchase choices.</p></li>
</ul>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09"></script>

<footer class="bd-footer">
  <div class="bd-footer__inner bd-page-width">
    <div class="footer-items__start">    
        <div class="footer-item">
          <p>© Copyright 2023, <a href="https://sites.google.com/site/yanhaomaxwei/" target="_blank">Yuanhao "Max" Wei</a>, 
                                <a href="https://jiangzhenling.com/" target="_blank">Zhenling Jiang </a>.</p>
    </div>                      
  </div>
</footer>

  </body>
</html>