


<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Code &#8212; pNNE  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=dcf890e0" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=927b94d3fcb96560df09"></script>

    <script src="../_static/documentation_options.js?v=8a448e45"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'code/code';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data" href="../data/data.html" />
    <link rel="prev" title="&lt;no title&gt;" href="../home/home.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
   

<a class="navbar-brand logo" href="https://pnnehome.github.io">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
    <p class="title logo__title">pre-trained NNE</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../home/home.html">
                         Home
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                         Code
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../data/data.html">
                         Data
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contact/contact.html">
                         Contact
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../home/home.html">
                         Home
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                         Code
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../data/data.html">
                         Data
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contact/contact.html">
                         Contact
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Code</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="code">
<span id="id1"></span><h1>Code<a class="headerlink" href="#code" title="Link to this heading">#</a></h1>
<p>You can find the Matlab (R2024b) files in this <a class="reference external" href="https://github.com/pnnehome/code_matlab" rel="noopener noreferrer" target="_blank">GitHub directory</a> (we plan to provide Python/R code in the near future). Explanation for each file is provided below. However, we suggest first reading the example on the <a class="reference internal" href="../home/home.html#home"><span class="std std-ref">home</span></a> page, which is an easier way to get an overall idea of how the code works.</p>
<section id="range-of-data-accepted">
<h2>Range of data accepted:<a class="headerlink" href="#range-of-data-accepted" title="Link to this heading">#</a></h2>
<p>Below list the data dimensions currently accepted by the main file <code class="docutils literal notranslate"><span class="pre">nne_estimate.m</span></code>. (<span class="note-text">Note: current settings may seem restrictive, but we can adjust them in the future if needed — feel free to contact us.</span>)</p>
<ul class="simple">
<li><p><strong>Sample size</strong>: <span class="math notranslate nohighlight">\(n\)</span> ≥ 1000 consumers (or search sessions).</p></li>
<li><p><strong>Number of options</strong>: 15 ≤ <span class="math notranslate nohighlight">\(J\)</span> ≤ 35.</p></li>
<li><p>Number of <strong>product attributes</strong> is ≥ 2 and ≤ 8.</p></li>
<li><p>Number of <strong>consumer attributes</strong> is ≤ 5.</p></li>
<li><p>Number of <strong>advertising attributes</strong> is ≤ 2.</p></li>
</ul>
<p>In addition, the NNE is pretrained on data with following characteristics. If your data’s characteristics fall outside these ranges, the pretrained NNE may not work as intended.</p>
<ul class="simple">
<li><p><strong>Buy rate</strong> (fraction of consumers who bought inside good) is 0.5% ~ 70%.</p></li>
<li><p><strong>Search rate</strong> (fraction of consumers who went beyond free search) is 1% ~ 80%.</p></li>
<li><p><strong>Average number of searches</strong> per consumer is 1 ~ 6.</p></li>
</ul>
<p>The attributes, <code class="docutils literal notranslate"><span class="pre">Xp</span></code>, <code class="docutils literal notranslate"><span class="pre">Xa</span></code>, <code class="docutils literal notranslate"><span class="pre">Xc</span></code>, need not be standardized. However, we recommend de-meaning them which makes the intercepts (<span class="math notranslate nohighlight">\(\alpha_0, \eta_0\)</span>) easier to interpret. We also recommend the usual practices to treat outliers (e.g., winsorizing, transformation) before using the pretrained NNE.</p>
</section>
<section id="description-of-files">
<h2>Description of files<a class="headerlink" href="#description-of-files" title="Link to this heading">#</a></h2>
<section id="trained-nne-mat">
<h3><code class="docutils literal notranslate"><span class="pre">trained_nne.mat</span></code><a class="headerlink" href="#trained-nne-mat" title="Link to this heading">#</a></h3>
<p>This file stores the trained neural net as well as some pre-defined settings.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nne</span></code>: a structure that stores the trained neural net, as well as some settings used in training, such as the range of data dimensions and the prior of the search model parameter.</p></li>
</ul>
</section>
<section id="nne-estimate-m">
<h3><code class="docutils literal notranslate"><span class="pre">nne_estimate.m</span></code><a class="headerlink" href="#nne-estimate-m" title="Link to this heading">#</a></h3>
<p>This is the main function that applies the pretrained NNE to your data.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">result = nne_estimate(nne, Y, Xp, Xa, Xc, consumer_idx, se = false, checks = true)</span>
</pre></div>
</div>
<p>Inputs:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nne</span></code>: already described above, from <code class="docutils literal notranslate"><span class="pre">trained_nne.mat</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Y</span></code>: <span class="math notranslate nohighlight">\(nJ\)</span> by 2 matrix. The <span class="math notranslate nohighlight">\(((i-1)J+j)\)</span>th row corresponds to product <span class="math notranslate nohighlight">\(j\)</span> for consumer <span class="math notranslate nohighlight">\(i\)</span>. The first value indicates if <span class="math notranslate nohighlight">\(j\)</span> is searched, and the second value indicates if <span class="math notranslate nohighlight">\(j\)</span> is bought.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Xp</span></code>: a matrix with <span class="math notranslate nohighlight">\(nJ\)</span> rows. The <span class="math notranslate nohighlight">\(((i-1)J+j)\)</span>th row stores the product attributes of product <span class="math notranslate nohighlight">\(j\)</span> for consumer <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Xa</span></code>: a matrix with <span class="math notranslate nohighlight">\(nJ\)</span> rows. The <span class="math notranslate nohighlight">\(((i-1)J+j)\)</span>th row stores the advertising attributes of product <span class="math notranslate nohighlight">\(j\)</span> for consumer <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Xc</span></code>: a matrix with <span class="math notranslate nohighlight">\(n\)</span> rows. The <span class="math notranslate nohighlight">\(i\)</span>th row stores the consumer attributes of consumer <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consumer_idx</span></code>: a column vector with <span class="math notranslate nohighlight">\(nJ\)</span> values. The <span class="math notranslate nohighlight">\(((i-1)J+j)\)</span>th value equals <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">se</span> <span class="pre">=</span> <span class="pre">false</span></code>: optional input. Set it to “true” to calculate bootstrap standard errors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checks</span> <span class="pre">=</span> <span class="pre">true</span></code>: optional input. Set it to “false” to omit all sanity checks.</p></li>
</ul>
<p>Output:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code>: a table showing parameter estimate and bootstrap standard errors (if selected).</p></li>
</ul>
</section>
<section id="moments-m">
<h3><code class="docutils literal notranslate"><span class="pre">moments.m</span></code><a class="headerlink" href="#moments-m" title="Link to this heading">#</a></h3>
<p>This function is used by <code class="docutils literal notranslate"><span class="pre">nne_estimate.m</span></code>. It computes data moments. The moments include summary statistics as well as coefficients of reduced-form regressions. These data moments are fed into the neural net as inputs.</p>
</section>
<section id="reg-logit-m">
<h3><code class="docutils literal notranslate"><span class="pre">reg_logit.m</span></code><a class="headerlink" href="#reg-logit-m" title="Link to this heading">#</a></h3>
<p>This function is used by <code class="docutils literal notranslate"><span class="pre">moments.m</span></code>. It performs ridge logit or multinomial-logit regressions. It runs faster than Matlab built-in regressions. The speedup is helpful for pretraining but less important when applying the pretrained NNE. Nevertheless, we make use of it in both pretraining and applications.</p>
</section>
<section id="reg-linear-m">
<h3><code class="docutils literal notranslate"><span class="pre">reg_linear.m</span></code><a class="headerlink" href="#reg-linear-m" title="Link to this heading">#</a></h3>
<p>This function is used by <code class="docutils literal notranslate"><span class="pre">moments.m</span></code>. It performs ridge linear regression.</p>
</section>
<section id="data-checks-m">
<h3><code class="docutils literal notranslate"><span class="pre">data_checks.m</span></code><a class="headerlink" href="#data-checks-m" title="Link to this heading">#</a></h3>
<p>This function is used by <code class="docutils literal notranslate"><span class="pre">nne_estimate.m</span></code> to run some basic sanity checks on data. For example, did every consumer buy at most one option; did every consumer conduct the free search?</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><span class="note-text">Note: The following files are not required to apply the pretrained NNE. They are provided for reference purposes.</span></p>
</section>
<section id="curve-mat">
<h3><code class="docutils literal notranslate"><span class="pre">curve.mat</span></code><a class="headerlink" href="#curve-mat" title="Link to this heading">#</a></h3>
<p>This file stores a lookup table for the relation between search cost and reservation utility. This relation is useful for computing the optimal consumer choices in the sequential search model.</p>
</section>
<section id="search-model-m">
<h3><code class="docutils literal notranslate"><span class="pre">search_model.m</span></code><a class="headerlink" href="#search-model-m" title="Link to this heading">#</a></h3>
<p>This function codes the search model. The function is used in pretraining but not in application. We provide it for reference purpose. It is also useful if you want to conduct Monte Carlo experiments.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Y = search_model(par, curve, Xp, Xa, Xc, consumer_idx)</span>
</pre></div>
</div>
<p>Inputs:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">par</span></code>: vector of the parameter value for the search model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">curve</span></code>: a lookup table as described above, from <code class="docutils literal notranslate"><span class="pre">curve.mat</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Xp</span></code>, <code class="docutils literal notranslate"><span class="pre">Xa</span></code>, <code class="docutils literal notranslate"><span class="pre">Xc</span></code>, and <code class="docutils literal notranslate"><span class="pre">consumer_idx</span></code>: data as described before.</p></li>
</ul>
<p>Outputs</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Y</span></code>: a matrix with the simulated search and purchase choices, formatted as described before.</p></li>
</ul>
</section>
<section id="winsorize-m">
<h3><code class="docutils literal notranslate"><span class="pre">winsorize.m</span></code><a class="headerlink" href="#winsorize-m" title="Link to this heading">#</a></h3>
<p>This function winsorizes data at 0.5 and 99.5 percentiles. We suggest applying it to your data before applying the pretrained NNE. For example, Xp = winsorize(Xp).</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#range-of-data-accepted">Range of data accepted:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#description-of-files">Description of files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trained-nne-mat"><code class="docutils literal notranslate"><span class="pre">trained_nne.mat</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nne-estimate-m"><code class="docutils literal notranslate"><span class="pre">nne_estimate.m</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#moments-m"><code class="docutils literal notranslate"><span class="pre">moments.m</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reg-logit-m"><code class="docutils literal notranslate"><span class="pre">reg_logit.m</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reg-linear-m"><code class="docutils literal notranslate"><span class="pre">reg_linear.m</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-checks-m"><code class="docutils literal notranslate"><span class="pre">data_checks.m</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-mat"><code class="docutils literal notranslate"><span class="pre">curve.mat</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-model-m"><code class="docutils literal notranslate"><span class="pre">search_model.m</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#winsorize-m"><code class="docutils literal notranslate"><span class="pre">winsorize.m</span></code></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09"></script>

<footer class="bd-footer">
  <div class="bd-footer__inner bd-page-width">
    <div class="footer-items__start">    
        <div class="footer-item">
          <p>© Copyright 2023, <a href="https://sites.google.com/site/yanhaomaxwei/" target="_blank">Yanhao "Max" Wei</a>, 
                                <a href="https://jiangzhenling.com/" target="_blank">Zhenling Jiang </a>.</p>
    </div>                      
  </div>
</footer>

  </body>
</html>